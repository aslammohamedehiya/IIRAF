<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Triage & Auto-Resolution</title>
    <link rel="stylesheet" href="style.css?v=2.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-brand">Incident Triage & Auto-Resolution</div>
        <div class="nav-user">
            <span>Aslam Ehiya (Admin)</span>
            <div class="avatar">AE</div>
        </div>
    </nav>

    <div class="main-container">

        <!-- Search Section -->
        <div class="search-section">
            <label>Issue Description / Symptom</label>
            <div class="search-bar">
                <i data-lucide="search" class="search-icon"></i>
                <input type="text" id="search-input" placeholder="e.g., Payment Gateway 500 errors..."
                    oninput="predictSeverityOnInput()">
                <button class="analyze-btn" onclick="performAnalysis()">Analyze</button>
            </div>
            <div id="severity-prediction" class="severity-prediction hidden">
                <span class="severity-label">Predicted Severity:</span>
                <span id="severity-badge" class="severity-badge"></span>
                <span id="severity-confidence" class="severity-confidence"></span>
                <button class="model-info-toggle" onclick="toggleModelInfo()">Model Info</button>
            </div>
            <div id="model-info" class="model-info hidden">
                <div class="model-info-content">
                    <div class="model-metric">
                        <span class="model-metric-label">Model Accuracy:</span>
                        <span class="model-metric-value" id="model-accuracy">-</span>
                    </div>
                    <div class="model-metric">
                        <span class="model-metric-label">Training Samples:</span>
                        <span class="model-metric-value" id="model-samples">-</span>
                    </div>
                    <div class="model-metric">
                        <span class="model-metric-label">Last Trained:</span>
                        <span class="model-metric-value" id="model-trained">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-grid">

            <!-- LEFT COLUMN -->
            <div class="left-panel">

                <!-- Recommended Solution -->
                <div class="card solution-card">
                    <div class="card-header blue-header">
                        <i data-lucide="wand-2"></i> Recommended Solution (AI Generated)
                    </div>
                    <div class="card-body">
                        <p class="summary-text">Based on <strong id="inc-count">3 similar incidents</strong> and <strong
                                id="kb-count">2 KB articles</strong>, here is the recommended resolution path:</p>
                        <ul class="steps-list" id="resolution-steps">
                            <!-- Populated by JS -->
                            <li>Step 1: Verify API Rate Limits. Past incidents indicate high traffic triggers 500s.</li>
                            <li>Step 2: Check Pod Health. Use <code>kubectl get pods</code> to identify crash loops.
                            </li>
                            <li>Step 3: If pods are unhealthy, perform rolling restart (See Auto-Heal panel).</li>
                        </ul>
                        <div class="tags" id="solution-tags">
                            <span class="tag">INC-4920</span>
                            <span class="tag">KB-102</span>
                            <span class="tag">INC-3310</span>
                        </div>
                    </div>
                </div>

                <!-- Supporting Evidence -->
                <div class="section-title-row">
                    <span>SUPPORTING EVIDENCE</span>
                    <span>RELEVANCE</span>
                </div>

                <div id="evidence-list">
                    <!-- Evidence Items -->
                </div>

                <!-- Fallback / Create Incident -->
                <div class="card fallback-card">
                    <h3>Resolution Not Found?</h3>
                    <p>If the AI recommendations and patterns do not resolve the issue, create a formal incident ticket
                        for L3 support.</p>
                    <button class="create-inc-btn">+ Create New Incident</button>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="right-panel">

                <!-- KB Articles Section -->
                <div class="card kb-card">
                    <div class="kb-header">
                        <i data-lucide="book-open"></i> Knowledge Base Articles
                    </div>
                    <div class="kb-body" id="kb-articles-list">
                        <!-- KB Articles will be populated here by JS -->
                    </div>
                </div>

                <!-- Pattern Detected - DISABLED -->
                <div class="card pattern-card hidden" id="pattern-panel" style="display: none;">
                    <div class="pattern-header-text">
                        <i data-lucide="alert-triangle"></i> Pattern Detected
                        <span class="info-icon">
                            ?
                            <span class="tooltip">HDBSCAN detected recurring incident pattern</span>
                        </span>
                    </div>
                    <p style="font-size: 0.8rem; color: #9a3412; padding: 0 1rem; margin-bottom: 0.5rem;">
                        <strong>Why this matters:</strong> Your issue matches a known recurring pattern. This means we
                        have seen this before and likely have a proven solution.
                    </p>
                    <div class="pattern-box">
                        <p><strong>Pattern <span id="pattern-id">P002</span> identified.</strong></p>
                        <p id="pattern-desc">This matches a known recurring issue: "Payment Gateway Timeout Cluster B".
                        </p>
                    </div>
                    <p class="pattern-meta">Frequency: <strong id="pattern-freq">45 times</strong> in last 30 days.</p>
                </div>

                <!-- Auto-Heal -->
                <div class="card autoheal-card hidden" id="autoheal-panel">
                    <div class="autoheal-header-text">
                        <i data-lucide="bot"></i> Auto-Heal Available
                    </div>
                    <p>A validated script exists to resolve this pattern.</p>
                    <div class="code-block" id="heal-script">./restart_svc.sh -n payment -r us-east</div>
                    <button class="remediation-btn" onclick="runRemediation()">
                        <i data-lucide="play"></i> Run Remediation
                    </button>
                    <div id="remediation-status" class="status-msg"></div>
                </div>

                <!-- Cluster Details Panel - DISABLED -->
                <div class="card cluster-card hidden" id="cluster-panel" style="display: none;">
                    <div class="cluster-header">
                        <i data-lucide="layers"></i> Cluster Details
                        <span class="info-icon">
                            ?
                            <span class="tooltip">HDBSCAN cluster analysis of similar incidents</span>
                        </span>
                    </div>
                    <div class="cluster-body">
                        <p style="font-size: 0.8rem; color: #0c4a6e; margin-bottom: 1rem;">
                            <strong>What this shows:</strong> A group of similar incidents that our AI has clustered
                            together.
                            This helps you understand the broader context and common themes.
                        </p>
                        <div class="cluster-metrics">
                            <div class="cluster-metric">
                                <div class="cluster-metric-label">Cluster ID</div>
                                <div class="cluster-metric-value" id="cluster-id">-</div>
                            </div>
                            <div class="cluster-metric">
                                <div class="cluster-metric-label">Size</div>
                                <div class="cluster-metric-value" id="cluster-size">-</div>
                            </div>
                        </div>
                        <div class="cluster-description" id="cluster-description">
                            No cluster information available
                        </div>
                        <div class="cluster-incidents">
                            <div class="cluster-incidents-title">Representative Incidents</div>
                            <ul class="cluster-incidents-list" id="cluster-incidents-list">
                                <li>No incidents to display</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Incident Visualization Map - DISABLED -->
                <div class="card viz-card" style="display: none;">
                    <div class="viz-header">
                        <i data-lucide="map"></i> Incident Map Visualization
                        <span class="info-icon">
                            ?
                            <span class="tooltip">UMAP 2D projection of incident embeddings</span>
                        </span>
                    </div>
                    <div class="viz-body">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                            <strong>What this does:</strong> Visualizes all incidents in a 2D space where similar
                            incidents cluster together.
                            This helps identify patterns and outliers at a glance.
                        </p>
                        <button class="viz-load-btn" onclick="openIncidentMapModal()" style="width: 100%;">
                            <i data-lucide="maximize-2"></i> Open Incident Map
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal for Incident Map - DISABLED -->
    <div id="incident-map-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i data-lucide="map"></i>
                    Incident Map Visualization
                </div>
                <button class="modal-close" onclick="closeIncidentMapModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="viz-filters">
                    <select id="severity-filter" onchange="loadIncidentMap()">
                        <option value="">All Severities</option>
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                    <button class="viz-load-btn" onclick="loadIncidentMap()">
                        <i data-lucide="refresh-cw"></i> Refresh Map
                    </button>
                </div>
                <canvas id="incident-map-canvas" width="900" height="500"></canvas>
                <div id="viz-stats" class="viz-stats"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Incident Details -->
    <div id="incident-detail-modal" class="incident-detail-modal">
        <div class="incident-detail-content">
            <div class="incident-detail-header">
                <div class="incident-detail-title">
                    <i data-lucide="file-text"></i>
                    <span id="incident-modal-id">Incident Details</span>
                </div>
                <button class="modal-close" onclick="closeIncidentDetailModal()">×</button>
            </div>
            <div class="incident-detail-body">
                <div class="incident-detail-section">
                    <div class="incident-detail-label">
                        <i data-lucide="info"></i>
                        Description
                    </div>
                    <div class="incident-detail-text" id="incident-modal-description">
                        Loading...
                    </div>
                </div>
                <div class="incident-detail-section">
                    <div class="incident-detail-label">
                        <i data-lucide="check-circle"></i>
                        Resolution
                    </div>
                    <div class="incident-detail-text" id="incident-modal-resolution">
                        Loading...
                    </div>
                </div>
                <div class="incident-detail-footer">
                    <div class="incident-relevance-badge">
                        <span class="relevance-label">Relevance Score:</span>
                        <span class="relevance-value" id="incident-modal-score">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js?v=2.0"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>